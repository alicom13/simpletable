/*!
 * SimpleTable v1.0.8 - Complete Table Library
 * Description: SimpleTable adalah library JavaScript yang mengubah tabel HTML biasa 
 * menjadi table cerdas lengkap dengan satu class saja. Tambahkan class='simpletable', 
 * dan langsung dapatkan pagination, sorting, real-time search, row selection, dan export 
 * - semua otomatis, tanpa konfigurasi, dan siap pakai di semua device!
 * 
 * Features:
 * âœ… Plug & Play - Just add class="simpletable"
 * âœ… Pagination with smart page display
 * âœ… Multi-column sorting (text & numbers)
 * âœ… Real-time search with debouncing
 * âœ… Row selection & bulk actions
 * âœ… Export to CSV, Excel, and Selected Rows
 * âœ… Fully responsive design
 * âœ… Zero dependencies, vanilla JS
 * âœ… Customizable styling
 * âœ… Accessible with ARIA attributes
 * 
 * @copyright  2025 
 * @author    Ali Musthofa
 * @link      https://github.com/alicom13/simpletable
 * @license   MIT
 */class SimpleTable{constructor(t,e=10){if(!t)throw new Error("Table element is required");this.table=t,this.tbody=t.querySelector("tbody"),this.rows=Array.from(this.tbody.querySelectorAll("tr")),this.filteredRows=[...this.rows],this.page=1,this.perPage=e,this.sortColumn=null,this.sortDirection="asc",this.searchTerm="",this.checkboxState=new WeakMap,this.searchHandler=this.debounce(this.setSearch.bind(this),300),this.createControls(),this.enableSorting(),this.initCheckboxes(),this.render()}createControls(){const t=document.createElement("div");t.className="simpletable-container";const e=document.createElement("div");e.className="simpletable-controls";const i=document.createElement("div");i.className="simpletable-search";this.searchBox=document.createElement("input"),this.searchBox.type="search",this.searchBox.placeholder="Search...",this.searchBox.addEventListener("input",t=>this.searchHandler(t.target.value));const s=document.createElement("div");s.className="simpletable-controls-right";const a=document.createElement("div");a.className="simpletable-export-group";const o=document.createElement("button");o.className="simpletable-export-btn selected",o.innerHTML="âœ“",o.title="Export Selected Rows",o.setAttribute("aria-label","Export selected rows"),o.onclick=()=>this.exportSelected();this.csvBtn=document.createElement("button"),this.csvBtn.className="simpletable-export-btn csv",this.csvBtn.innerHTML="ðŸ“Š",this.csvBtn.title="Export to CSV",this.csvBtn.setAttribute("aria-label","Export to CSV"),this.csvBtn.onclick=()=>this.exportToCSV();this.excelBtn=document.createElement("button"),this.excelBtn.className="simpletable-export-btn excel",this.excelBtn.innerHTML="ðŸ“—",this.excelBtn.title="Export to Excel",this.excelBtn.setAttribute("aria-label","Export to Excel"),this.excelBtn.onclick=()=>this.exportToExcel(),a.appendChild(o),a.appendChild(this.csvBtn),a.appendChild(this.excelBtn);const r=document.createElement("div");r.className="simpletable-pagination-controls";this.selectionCounter=document.createElement("span"),this.selectionCounter.className="simpletable-selection",this.updateSelectionCounter();this.perPageSelect=document.createElement("select"),this.perPageSelect.className="simpletable-perpage",this.perPageSelect.setAttribute("aria-label","Rows per page"),this.perPageSelect.innerHTML='<option value="5">5</option><option value="10" selected>10</option><option value="20">20</option><option value="50">50</option><option value="100">100</option>',this.perPageSelect.value=this.perPage,this.perPageSelect.addEventListener("change",()=>{this.perPage=parseInt(this.perPageSelect.value),this.page=1,this.render()}),r.appendChild(this.selectionCounter),r.appendChild(this.perPageSelect),i.appendChild(this.searchBox),s.appendChild(a),s.appendChild(r),e.appendChild(i),e.appendChild(s),t.appendChild(e),this.table.parentNode.insertBefore(t,this.table),t.appendChild(this.table),this.paginationContainer=document.createElement("div"),this.paginationContainer.className="simpletable-pagination",t.appendChild(this.paginationContainer),this.infoContainer=document.createElement("div"),this.infoContainer.className="simpletable-info",t.appendChild(this.infoContainer),this.updateInfo()}enableSorting(){this.table.querySelectorAll("thead th").forEach((t,e)=>{if(t.querySelector("input, select, button"))return;t.style.cursor="pointer",t.setAttribute("role","button"),t.setAttribute("aria-label",`Sort by ${t.textContent.trim()}`),t.addEventListener("click",()=>this.handleSort(e))})}handleSort(t){const e=this.table.querySelectorAll("thead th");e.forEach(t=>{t.classList.remove("sort-asc","sort-desc"),t.removeAttribute("aria-sort")}),this.sortColumn===t?this.sortDirection="asc"===this.sortDirection?"desc":"asc":(this.sortColumn=t,this.sortDirection="asc"),e[t].classList.add("sort-"+this.sortDirection),e[t].setAttribute("aria-sort","asc"===this.sortDirection?"ascending":"descending"),this.sortRows(),this.render()}sortRows(){if(null===this.sortColumn)return;this.filteredRows.sort((t,e)=>{const i=t.children[this.sortColumn],s=e.children[this.sortColumn];if(!i||!s)return 0;const a=i.textContent.trim().toLowerCase(),o=s.textContent.trim().toLowerCase(),r=parseFloat(a),n=parseFloat(o);return!isNaN(r)&&!isNaN(n)?"asc"===this.sortDirection?r-n:n-r:"asc"===this.sortDirection?a.localeCompare(o):o.localeCompare(a)})}debounce(t,e){let i;return function(...s){const a=()=>{clearTimeout(i),t(...s)};clearTimeout(i),i=setTimeout(a,e)}}setSearch(t){this.searchTerm=t.toLowerCase().trim(),this.filteredRows=this.rows.filter(e=>e.textContent.toLowerCase().includes(this.searchTerm)),null!==this.sortColumn&&this.sortRows(),this.page=1,this.render()}paginateRows(){const t=(this.page-1)*this.perPage;return this.filteredRows.slice(t,t+this.perPage)}renderTable(){const t=this.tbody.querySelector(".simpletable-empty");t&&t.remove(),this.rows.forEach(t=>{t.style.display="none"});if(0===this.filteredRows.length)return void this.showEmptyState();const e=this.paginateRows();e.forEach(t=>{t.style.display=""}),this.restoreCheckboxes(),this.updateRowNumbers(e),this.updateSelectionCounter(),this.updateInfo()}showEmptyState(){const t=document.createElement("tr");t.className="simpletable-empty",t.setAttribute("aria-live","polite");const e=this.table.querySelectorAll("thead th").length;t.innerHTML='<td colspan="'+e+'">No data found</td>',this.tbody.appendChild(t)}updateRowNumbers(t){const e=(this.page-1)*this.perPage+1;t.forEach((t,i)=>{const s=t.querySelector(".row-number");s&&(s.textContent=e+i)})}updateInfo(){const t=this.filteredRows.length,e=0===t?0:(this.page-1)*this.perPage+1,i=Math.min(this.page*this.perPage,t);this.infoContainer.textContent=`Showing ${e} to ${i} of ${t} entries`,this.infoContainer.setAttribute("aria-live","polite")}renderPagination(){const t=this.paginationContainer,e=Math.ceil(this.filteredRows.length/this.perPage);if(e<=1)return void(t.innerHTML="");const i=1===this.page,s=this.page>=e;let a=`<button class="pagination-prev" ${i?"disabled":""} aria-label="Previous page">â€¹</button>`,o=this.getVisiblePages(e);o.forEach(e=>{a+="..."===e?'<button class="pagination-ellipsis" disabled aria-hidden="true">...</button>':`<button class="pagination-number ${e===this.page?"active":""} ${e===this.page?'aria-current="page"':""} aria-label="Page ${e}">${e}</button>`}),a+=`<button class="pagination-next" ${s?"disabled":""} aria-label="Next page">â€º</button>`,t.innerHTML=a,t.querySelector("button:first-child").addEventListener("click",()=>{i||(this.page--,this.render())}),t.querySelector("button:last-child").addEventListener("click",()=>{s||(this.page++,this.render())}),t.querySelectorAll("button:not(:first-child):not(:last-child)").forEach(t=>{t.disabled||"..."===t.textContent||t.addEventListener("click",()=>{this.page=parseInt(t.textContent),this.render()})})}getVisiblePages(t){if(t<=7)return Array.from({length:t},(t,e)=>e+1);if(this.page<=4)return[1,2,3,4,5,"...",t];if(this.page>=t-3)return[1,"...",t-4,t-3,t-2,t-1,t];return[1,"...",this.page-1,this.page,this.page+1,"...",t]}initCheckboxes(){this.tbody.addEventListener("change",t=>{const e=t.target;if("checkbox"===e.type){this.checkboxState.set(e,e.checked),this.updateSelectionCounter()}});const t=this.table.querySelector("thead input[type=checkbox]");t&&t.addEventListener("change",t=>{const e=t.target.checked;this.paginateRows().forEach(t=>{const i=t.querySelector("input[type=checkbox]");i&&(i.checked=e,this.checkboxState.set(i,e))}),this.updateSelectionCounter()})}restoreCheckboxes(){this.paginateRows().forEach(t=>{const e=t.querySelector("input[type=checkbox]");e&&this.checkboxState.has(e)&&(e.checked=this.checkboxState.get(e))}),this.updateSelectAllCheckbox()}updateSelectAllCheckbox(){const t=this.table.querySelector("thead input[type=checkbox]");if(t){const e=this.paginateRows().map(t=>t.querySelector("input[type=checkbox]")).filter(t=>t);0===e.length?(t.checked=!1,t.disabled=!0):(t.disabled=!1,t.checked=e.every(t=>t.checked))}}updateSelectionCounter(){const t=this.getSelectedCount(),e=this.filteredRows.length;this.selectionCounter.textContent=`${t} of ${e} selected`,this.selectionCounter.setAttribute("aria-live","polite")}getSelectedCount(){let t=0;return this.filteredRows.forEach(e=>{const i=e.querySelector('input[type="checkbox"]');i&&i.checked&&t++}),t}exportSelected(){const t=this.getSelectedRows();if(0===t.length)return void alert("No data selected! Check the rows you want to export.");const e=this.getExportData(t),i=this.convertToCSV(e);this.downloadFile(i,"selected-data-"+this.getTimestamp()+".csv","text/csv"),alert(`Successfully exported ${t.length} selected rows!`)}getSelectedRows(){const t=[];return this.filteredRows.forEach(e=>{const i=e.querySelector('input[type="checkbox"]');i&&i.checked&&t.push(e)}),t}getSelectedIds(){return this.getSelectedRows().map(t=>{const e=t.querySelector('input[type="checkbox"]');return e?e.value:null}).filter(t=>null!==t)}getTableHeaders(){const t=[];return this.table.querySelectorAll("thead th").forEach(e=>{e.querySelector('input[type="checkbox"]')||"No"===e.textContent.trim()||e.classList.contains("no-export")||t.push(e.textContent.trim())}),t}getExportData(t=null){const e=t||this.filteredRows,i=this.getTableHeaders();return e.map(t=>{const e={},s=t.querySelectorAll("td");let a=0;return this.table.querySelectorAll("thead th").forEach((t,o)=>{t.querySelector('input[type="checkbox"]')||"No"===t.textContent.trim()||t.classList.contains("no-export")||!s[o]||!i[a]||(e[i[a]]=s[o].cloneNode(!0).textContent.trim(),a++)}),e})}exportToCSV(){const t=this.getExportData(),e=this.convertToCSV(t);this.downloadFile(e,"table-export-"+this.getTimestamp()+".csv","text/csv")}exportToExcel(){if("undefined"==typeof XLSX)return alert("Excel export requires SheetJS library. Falling back to CSV."),void this.exportToCSV();const t=this.getExportData(),e=XLSX.utils.book_new(),i=XLSX.utils.json_to_sheet(t);XLSX.utils.book_append_sheet(e,i,"Sheet1"),XLSX.writeFile(e,"table-export-"+this.getTimestamp()+".xlsx")}convertToCSV(t){if(0===t.length)return"";const e=Object.keys(t[0]);return[e.join(","),...t.map(t=>e.map(e=>{const i=t[e]||"",s=i.toString().replace(/"/g,'""');return s.includes(",")||s.includes("\n")||s.includes('"')?'"'+s+'"':s}).join(","))].join("\n")}downloadFile(t,e,i){const s=new Blob([t],{type:i}),a=URL.createObjectURL(s),o=document.createElement("a");o.href=a,o.download=e,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(a)}getTimestamp(){return new Date().toISOString().slice(0,19).replace(/[:.]/g,"-")}render(){this.renderTable(),this.renderPagination()}updateData(t){if(Array.isArray(t))this.rows=t;else if("string"==typeof t)this.tbody.innerHTML=t,this.rows=Array.from(this.tbody.querySelectorAll("tr"));else if(t instanceof NodeList)this.rows=Array.from(t);else return;this.filteredRows=[...this.rows],this.page=1,this.render()}destroy(){const t=this.table.parentNode;t.classList.contains("simpletable-container")&&(t.parentNode.insertBefore(this.table,t),t.remove())}}document.addEventListener("DOMContentLoaded",()=>{window.simpleTables=[],document.querySelectorAll(".simpletable").forEach(t=>{try{const e=new SimpleTable(t,10);window.simpleTables.push(e)}catch{}})}),"undefined"!=typeof module&&module.exports&&(module.exports=SimpleTable),"undefined"!=typeof window&&(window.SimpleTable=SimpleTable);
